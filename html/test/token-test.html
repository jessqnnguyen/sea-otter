<html>
	<head>
		<meta name="Access-Control-Allow-Origin" content="*"></meta>
	</head>
	<body>
		<form id="passwordForm">
			<input type="password" name="passwordField"/>
			<input type="submit" value="submit password" id="testbutton"/>
		</form>
		
		<button id="useToken">Use Token</button>
		<button id="deleteAll">Delete all Tokens</button>
	</body>
	
	<script>
		var passwordForm = document.getElementById("passwordForm");
		var tokenButton = document.getElementById("useToken");
		var deleteAllButton = document.getElementById("deleteAll");
		
		var password = passwordForm['passwordField'];
		
		passwordForm.onsubmit = function() {
		
			var request = new XMLHttpRequest();
			
			request.onreadystatechange = function() {
			
				if (request.readyState !== XMLHttpRequest.DONE) {
					return;
				}
				
				var response = JSON.parse(request.response);
				
				if(response.passwordSuccess == true) {
				
					AddDebugElement("token is " + response.token);
					
					document.cookie = "token=" + response.token;
				}
				else {
					AddDebugElement("invalid password");
				}
			}
			request.open("POST","http://127.0.0.1:82/v1/auth/new-token.php");
			request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			request.send("password="+password.value);
			
			return false;
		}
		
		tokenButton.onclick = function() {
		
			var request = new XMLHttpRequest();
			
			request.onreadystatechange = function() {
			
				if (request.readyState !== XMLHttpRequest.DONE) {
					return;
				}
				
				var response = JSON.parse(request.response);
				
				if(response.success == true) {
				
					AddDebugElement("token consumed and regenerated");
					
					document.cookie = "token=" + response.token;
				}
				else {
					AddDebugElement("token was not accepted");
				}
			}
			request.open("POST","http://127.0.0.1:82/v1/auth/consume-token.php");
			request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			request.send(document.cookie);
		}
		
		deleteAllButton.onclick = function() {
		
			var request = new XMLHttpRequest();
			
			request.onreadystatechange = function() {
			
				if (request.readyState !== XMLHttpRequest.DONE) {
					return;
				}
				
				var response = JSON.parse(request.response);
				
				if(response.success == true) {
					AddDebugElement("all tokens deleted");
				}
				else {
					AddDebugElement("token was not accepted");
				}
			}
			request.open("POST","http://127.0.0.1:82/v1/auth/delete-all-tokens.php");
			request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			request.send(document.cookie);
		}
		
		function AddDebugElement(content) {
		
			var element = document.createElement("p");
			
			element.innerHTML = content;
			
			document.body.appendChild(element);
			
		}
	</script>
</html>